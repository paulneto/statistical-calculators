<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-Hoc Tests Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.5/jstat.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function PostHocCalculator() {
            // Example data: Email open rates for 4 different subject line types
            const exampleData = `QuestionBased,12.5,15.3,13.8,14.2,16.1
UrgencyBased,18.2,19.5,17.8,20.1,18.9
Personalized,14.5,15.8,13.9,16.2,14.7
EmojiIncluded,16.8,17.5,15.9,18.2,16.4`;

            const [dataInput, setDataInput] = useState(exampleData);
            const [testType, setTestType] = useState('tukey');
            const [alpha, setAlpha] = useState(0.05);
            const [results, setResults] = useState(null);

            const calculatePostHoc = () => {
                try {
                    // Parse data
                    const lines = dataInput.trim().split('\n');
                    const groups = lines.map(line => {
                        const parts = line.split(',');
                        return {
                            name: parts[0],
                            values: parts.slice(1).map(v => parseFloat(v.trim()))
                        };
                    });

                    if (groups.length < 3) {
                        alert('Need at least 3 groups for post-hoc tests');
                        return;
                    }

                    // Calculate group statistics
                    const groupStats = groups.map(g => ({
                        name: g.name,
                        n: g.values.length,
                        mean: g.values.reduce((a, b) => a + b) / g.values.length,
                        variance: g.values.reduce((sum, val) => {
                            const mean = g.values.reduce((a, b) => a + b) / g.values.length;
                            return sum + Math.pow(val - mean, 2);
                        }, 0) / (g.values.length - 1)
                    }));

                    // Calculate MSE (Mean Square Error) - pooled variance
                    const allValues = groups.flatMap(g => g.values);
                    const grandMean = allValues.reduce((a, b) => a + b) / allValues.length;
                    const totalN = allValues.length;
                    const k = groups.length;

                    const SSW = groups.reduce((sum, g) => {
                        const groupMean = g.values.reduce((a, b) => a + b) / g.values.length;
                        return sum + g.values.reduce((s, val) => s + Math.pow(val - groupMean, 2), 0);
                    }, 0);
                    const dfWithin = totalN - k;
                    const MSE = SSW / dfWithin;

                    // Perform pairwise comparisons
                    const comparisons = [];
                    for (let i = 0; i < groupStats.length; i++) {
                        for (let j = i + 1; j < groupStats.length; j++) {
                            const g1 = groupStats[i];
                            const g2 = groupStats[j];
                            const meanDiff = Math.abs(g1.mean - g2.mean);

                            if (testType === 'tukey') {
                                // Tukey HSD
                                const SE = Math.sqrt(MSE * (1/g1.n + 1/g2.n) / 2);
                                const q = meanDiff / SE;

                                // Critical value from studentized range distribution
                                const qCritical = jStat.tukey.inv(1 - alpha, k, dfWithin);
                                const significant = q > qCritical;

                                comparisons.push({
                                    group1: g1.name,
                                    group2: g2.name,
                                    meanDiff,
                                    qStat: q,
                                    qCritical,
                                    pValue: null, // Tukey uses critical value comparison, not p-values
                                    significant
                                });
                            } else if (testType === 'bonferroni') {
                                // Bonferroni correction
                                const numComparisons = (k * (k - 1)) / 2;
                                const adjustedAlpha = alpha / numComparisons;
                                const SE = Math.sqrt(MSE * (1/g1.n + 1/g2.n));
                                const tStat = meanDiff / SE;
                                const pValue = 2 * (1 - jStat.studentt.cdf(Math.abs(tStat), dfWithin));
                                const tCritical = jStat.studentt.inv(1 - adjustedAlpha/2, dfWithin);
                                const significant = pValue < adjustedAlpha;

                                comparisons.push({
                                    group1: g1.name,
                                    group2: g2.name,
                                    meanDiff,
                                    tStat,
                                    pValue,
                                    adjustedAlpha,
                                    significant
                                });
                            }
                        }
                    }

                    setResults({
                        groupStats,
                        comparisons,
                        MSE,
                        dfWithin,
                        k,
                        totalN,
                        testType
                    });
                } catch (error) {
                    alert('Error calculating post-hoc tests: ' + error.message);
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 py-8">
                    <div className="max-w-6xl mx-auto px-4">
                        {/* Header */}
                        <div className="bg-gradient-to-r from-purple-500 to-indigo-500 rounded-lg shadow-lg p-8 mb-8 text-white">
                            <h1 className="text-4xl font-bold mb-4">Post-Hoc Tests Calculator</h1>
                            <p className="text-xl opacity-90">
                                Find which specific groups differ after ANOVA
                            </p>
                        </div>

                        {/* Info Section */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-8">
                            <h2 className="text-2xl font-bold mb-4 text-gray-800">When Do You Need Post-Hoc Tests?</h2>
                            <p className="text-gray-700 mb-4">
                                ANOVA tells you "at least one group is different" but doesn't say <strong>which specific groups</strong> differ.
                                Post-hoc tests perform pairwise comparisons while controlling for Type I error (false positives).
                            </p>
                            <div className="grid md:grid-cols-2 gap-4">
                                <div className="bg-purple-50 border-l-4 border-purple-500 p-4">
                                    <h3 className="font-bold text-purple-900 mb-2">Tukey HSD (Honest Significant Difference)</h3>
                                    <p className="text-sm text-gray-700">
                                        ‚Ä¢ Most common post-hoc test<br/>
                                        ‚Ä¢ Controls family-wise error rate<br/>
                                        ‚Ä¢ Best when all groups have similar sample sizes<br/>
                                        ‚Ä¢ More conservative (lower false positive rate)
                                    </p>
                                </div>
                                <div className="bg-blue-50 border-l-4 border-blue-500 p-4">
                                    <h3 className="font-bold text-blue-900 mb-2">Bonferroni Correction</h3>
                                    <p className="text-sm text-gray-700">
                                        ‚Ä¢ Very conservative<br/>
                                        ‚Ä¢ Divides Œ± by number of comparisons<br/>
                                        ‚Ä¢ Works with unequal sample sizes<br/>
                                        ‚Ä¢ Easy to understand and calculate
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* Settings */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-8">
                            <h2 className="text-2xl font-bold mb-4 text-gray-800">Test Settings</h2>
                            <div className="grid md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Post-Hoc Test Type
                                    </label>
                                    <select
                                        className="w-full p-2 border border-gray-300 rounded-lg"
                                        value={testType}
                                        onChange={(e) => setTestType(e.target.value)}
                                    >
                                        <option value="tukey">Tukey HSD</option>
                                        <option value="bonferroni">Bonferroni</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Significance Level (Œ±)
                                    </label>
                                    <select
                                        className="w-full p-2 border border-gray-300 rounded-lg"
                                        value={alpha}
                                        onChange={(e) => setAlpha(parseFloat(e.target.value))}
                                    >
                                        <option value="0.05">0.05 (5%)</option>
                                        <option value="0.01">0.01 (1%)</option>
                                        <option value="0.10">0.10 (10%)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* Data Input */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-8">
                            <h2 className="text-2xl font-bold mb-4 text-gray-800">Enter Your Data</h2>
                            <p className="text-gray-600 mb-4">
                                Format: Each line is a group. First value is the group name, followed by comma-separated data values.
                            </p>
                            <textarea
                                className="w-full h-48 p-4 border border-gray-300 rounded-lg font-mono text-sm"
                                value={dataInput}
                                onChange={(e) => setDataInput(e.target.value)}
                                placeholder="GroupA,12.5,15.3,13.8,14.2&#10;GroupB,18.2,19.5,17.8,20.1&#10;GroupC,14.5,15.8,13.9,16.2"
                            />
                            <button
                                onClick={calculatePostHoc}
                                className="mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200"
                            >
                                Calculate Post-Hoc Tests
                            </button>
                        </div>

                        {/* Results */}
                        {results && (
                            <div className="space-y-8">
                                {/* Group Summary */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h2 className="text-2xl font-bold mb-4 text-gray-800">Group Summary</h2>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="px-4 py-2 text-left">Group</th>
                                                    <th className="px-4 py-2 text-left">N</th>
                                                    <th className="px-4 py-2 text-left">Mean</th>
                                                    <th className="px-4 py-2 text-left">Variance</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {results.groupStats.map((g, i) => (
                                                    <tr key={i} className={i % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                        <td className="px-4 py-2 font-semibold">{g.name}</td>
                                                        <td className="px-4 py-2">{g.n}</td>
                                                        <td className="px-4 py-2">{g.mean.toFixed(3)}</td>
                                                        <td className="px-4 py-2">{g.variance.toFixed(3)}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Pairwise Comparisons */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h2 className="text-2xl font-bold mb-4 text-gray-800">
                                        Pairwise Comparisons ({results.testType === 'tukey' ? 'Tukey HSD' : 'Bonferroni'})
                                    </h2>
                                    {results.testType === 'tukey' && (
                                        <div className="mb-4 p-4 bg-purple-50 border-l-4 border-purple-500">
                                            <p className="text-sm text-gray-700">
                                                <strong>Tukey HSD Method:</strong> Comparisons are based on the studentized range distribution.
                                                A pair is significant if Q-statistic &gt; Q-critical at Œ± = {alpha}.
                                            </p>
                                        </div>
                                    )}
                                    {results.testType === 'bonferroni' && (
                                        <div className="mb-4 p-4 bg-blue-50 border-l-4 border-blue-500">
                                            <p className="text-sm text-gray-700">
                                                <strong>Adjusted Œ±:</strong> {results.comparisons[0].adjustedAlpha.toFixed(4)}
                                                {' '}(original Œ± = {alpha} √∑ {results.comparisons.length} comparisons)
                                            </p>
                                        </div>
                                    )}
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="px-4 py-2 text-left">Comparison</th>
                                                    <th className="px-4 py-2 text-left">Mean Difference</th>
                                                    <th className="px-4 py-2 text-left">
                                                        {results.testType === 'tukey' ? 'Q-statistic' : 'T-statistic'}
                                                    </th>
                                                    <th className="px-4 py-2 text-left">
                                                        {results.testType === 'tukey' ? 'Q-Critical' : 'P-value'}
                                                    </th>
                                                    <th className="px-4 py-2 text-left">Significant?</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {results.comparisons.map((comp, i) => (
                                                    <tr key={i} className={i % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                        <td className="px-4 py-2 font-semibold">
                                                            {comp.group1} vs {comp.group2}
                                                        </td>
                                                        <td className="px-4 py-2">{comp.meanDiff.toFixed(3)}</td>
                                                        <td className="px-4 py-2">
                                                            {(results.testType === 'tukey' ? comp.qStat : comp.tStat).toFixed(3)}
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            {results.testType === 'tukey' ? (
                                                                comp.qCritical.toFixed(3)
                                                            ) : (
                                                                comp.pValue < 0.0001 ? '<0.0001' : comp.pValue.toFixed(4)
                                                            )}
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            {comp.significant ? (
                                                                <span className="text-green-600 font-bold">‚úì YES</span>
                                                            ) : (
                                                                <span className="text-gray-500">‚úó No</span>
                                                            )}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Significant Differences Summary */}
                                <div className="bg-gradient-to-br from-green-50 to-teal-50 rounded-lg shadow-md p-6 border-2 border-green-200">
                                    <h2 className="text-2xl font-bold mb-4 text-green-900">üìä Summary</h2>
                                    {results.comparisons.filter(c => c.significant).length > 0 ? (
                                        <>
                                            <p className="text-gray-700 mb-4">
                                                <strong>Significant differences found:</strong>
                                            </p>
                                            <ul className="space-y-2">
                                                {results.comparisons.filter(c => c.significant).map((comp, i) => (
                                                    <li key={i} className="flex items-start">
                                                        <span className="text-green-600 mr-2">‚úì</span>
                                                        <span className="text-gray-700">
                                                            <strong>{comp.group1}</strong> differs significantly from <strong>{comp.group2}</strong>
                                                            {' '}(difference = {comp.meanDiff.toFixed(2)}{results.testType === 'tukey'
                                                                ? `, q = ${comp.qStat.toFixed(2)} > ${comp.qCritical.toFixed(2)}`
                                                                : `, p = ${comp.pValue.toFixed(4)}`})
                                                        </span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </>
                                    ) : (
                                        <p className="text-gray-700">
                                            No significant pairwise differences detected at Œ± = {alpha}.
                                        </p>
                                    )}
                                </div>

                                {/* Interpretation */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h2 className="text-2xl font-bold mb-4 text-gray-800">üí° How to Report Results</h2>
                                    <div className="space-y-4 text-gray-700">
                                        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4">
                                            <h3 className="font-bold text-yellow-900 mb-2">Example Write-Up:</h3>
                                            <p className="text-sm italic">
                                                "A one-way ANOVA revealed significant differences between groups, F(...) = ..., p &lt; .05.
                                                Post-hoc {results.testType === 'tukey' ? 'Tukey HSD' : 'Bonferroni'} tests showed that
                                                {results.comparisons.filter(c => c.significant).length > 0
                                                    ? ` ${results.comparisons.filter(c => c.significant).map(c => `${c.group1} (M = ${results.groupStats.find(g => g.name === c.group1).mean.toFixed(2)}) differed significantly from ${c.group2} (M = ${results.groupStats.find(g => g.name === c.group2).mean.toFixed(2)})`).join(', ')}.`
                                                    : ' no specific pairs differed significantly.'}"
                                            </p>
                                        </div>
                                        <div>
                                            <h3 className="font-bold mb-2">Key Points:</h3>
                                            <ul className="list-disc list-inside space-y-1 text-sm">
                                                <li>Always run ANOVA first - only do post-hoc if ANOVA is significant</li>
                                                <li>Report which test you used (Tukey or Bonferroni)</li>
                                                <li>Report means and standard deviations for each group</li>
                                                <li>State which specific pairs differed significantly</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Back Button */}
                        <div className="mt-8 text-center">
                            <a href="../index.html" className="text-purple-600 hover:text-purple-800 font-semibold">
                                ‚Üê Back to Calculator Collection
                            </a>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<PostHocCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
